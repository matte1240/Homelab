# Configurazione Traefik per ambiente {{ env_name | default('unknown') }}
api:
  dashboard: true
  insecure: true

# Logging configuration based on environment
log:
  level: "{{ traefik_log_level | default('INFO') }}"
{% if env_name == 'development' and enable_debug_endpoints | default(false) %}
  filePath: "/data/traefik.log"
{% endif %}

# Access logs for production monitoring
{% if env_name == 'production' and enable_monitoring | default(false) %}
accessLog:
  filePath: "/data/access.log"
  bufferingSize: 100
{% endif %}

entryPoints:
  http:
    address: ":80"
  https:
    address: ":443"

providers:
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false
  file:
    filename: /etc/traefik/dynamic.yml
    watch: true

{% if ssl_enabled | default(false) and env_name == 'production' %}
# Certificati SSL con Cloudflare (solo produzione)
certificatesResolvers:
  letsencrypt:
    acme:
      email: {{ cloudflare_email }}
      storage: /data/acme.json
      dnsChallenge:
        provider: cloudflare
        delayBeforeCheck: 30
        resolvers:
          - "1.1.1.1:53"
          - "8.8.8.8:53"

# TLS Options
tls:
  options:
    default:
      minVersion: "VersionTLS12"
      maxVersion: "VersionTLS13"
      cipherSuites:
        - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
        - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
        - "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305"
{% endif %}
